<div class="vehiculos-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-bus"></i>
        Gestión de Vehículos
      </h1>
      <p class="page-subtitle">
        Administración y control de vehículos registrados en DRTC Puno
      </p>
    </div>
    <div class="header-actions">
      <button type="button" class="btn btn-outline-secondary" (click)="verEliminados()">
        <i class="fas fa-trash-alt"></i>
        Eliminados
      </button>
      <button type="button" class="btn btn-success" (click)="exportarDatos()">
        <i class="fas fa-download"></i>
        Exportar
      </button>
      <button type="button" class="btn btn-primary" (click)="nuevoVehiculo()">
        <i class="fas fa-plus"></i>
        Nuevo Vehículo
      </button>
    </div>
  </div>

  <!-- Estadísticas -->
  @if (currentVehiculos().length > 0) {
    <div class="stats-section">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-bus"></i>
          </div>
          <div class="stat-content">
            <h3>{{ estadisticas().total }}</h3>
            <p>Total Vehículos</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon success">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ estadisticas().activos }}</h3>
            <p>Activos</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon warning">
            <i class="fas fa-tools"></i>
          </div>
          <div class="stat-content">
            <h3>{{ estadisticas().mantenimiento }}</h3>
            <p>En Mantenimiento</p>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon danger">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="stat-content">
            <h3>{{ estadisticas().suspendidos }}</h3>
            <p>Suspendidos</p>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-grid">
      <div class="filter-group">
        <label for="placa">Placa</label>
        <input 
          type="text" 
          id="placa" 
          [(ngModel)]="currentFiltros().placa"
          (input)="actualizarFiltroPlaca($any($event.target).value)"
          class="form-control"
          placeholder="Buscar por placa..."
        >
      </div>

      <div class="filter-group">
        <label for="marca">Marca</label>
        <input 
          type="text" 
          id="marca" 
          [(ngModel)]="currentFiltros().marca"
          (input)="actualizarFiltroMarca($any($event.target).value)"
          class="form-control"
          placeholder="Buscar por marca..."
        >
      </div>

      <div class="filter-group">
        <label for="modelo">Modelo</label>
        <input 
          type="text" 
          id="modelo" 
          [(ngModel)]="currentFiltros().modelo"
          (input)="actualizarFiltroModelo($any($event.target).value)"
          class="form-control"
          placeholder="Buscar por modelo..."
        >
      </div>

      <div class="filter-group">
        <label for="empresa">Empresa</label>
        <input 
          type="text" 
          id="empresa" 
          [(ngModel)]="currentFiltros().empresa"
          (input)="actualizarFiltroEmpresa($any($event.target).value)"
          class="form-control"
          placeholder="Buscar por empresa..."
        >
      </div>

      <div class="filter-group">
        <label for="tipo">Tipo</label>
        <select 
          id="tipo" 
          [(ngModel)]="currentFiltros().tipo"
          (change)="actualizarFiltroTipo($any($event.target).value)"
          class="form-control"
        >
          <option value="">Todos los tipos</option>
          <option value="BUS">Bus</option>
          <option value="MICROBUS">Microbús</option>
          <option value="COMBIS">Combis</option>
          <option value="CAMION">Camión</option>
          <option value="CAMIONETA">Camioneta</option>
          <option value="MOTOTAXI">Mototaxi</option>
          <option value="TAXI">Taxi</option>
          <option value="OTRO">Otro</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="estado">Estado</label>
        <select 
          id="estado" 
          [(ngModel)]="currentFiltros().estado"
          (change)="actualizarFiltroEstado($any($event.target).value)"
          class="form-control"
        >
          <option value="">Todos los estados</option>
          <option value="ACTIVO">Activo</option>
          <option value="MANTENIMIENTO">En Mantenimiento</option>
          <option value="SUSPENDIDO">Suspendido</option>
          <option value="BAJA">Baja</option>
        </select>
      </div>
    </div>

    <div class="filter-actions">
      <button type="button" class="btn btn-primary" (click)="aplicarFiltros()">
        <i class="fas fa-search"></i> Buscar
      </button>
      <button type="button" class="btn btn-outline-secondary" (click)="limpiarFiltros()">
        <i class="fas fa-times"></i> Limpiar
      </button>
    </div>
  </div>

  <!-- Loading -->
  @if (isLoading()) {
    <div class="loading-overlay">
      <div class="spinner"></div>
      <p>Cargando vehículos...</p>
    </div>
  }

  <!-- Error -->
  @if (hasError()) {
    <div class="error-message">
      <div class="error-content">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Error</h3>
        <p>{{ hasError() }}</p>
        <button type="button" class="btn btn-primary" (click)="cargarVehiculos()">
          Reintentar
        </button>
      </div>
    </div>
  }

  <!-- Content -->
  @if (!isLoading() && !hasError()) {
    <div class="content-section">
      <div class="results-info">
        <p>Mostrando {{ currentVehiculos().length }} de {{ currentTotalVehiculos() }} vehículos</p>
      </div>

      <!-- Tabla de vehículos -->
      @if (currentVehiculos().length > 0) {
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Placa</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Año</th>
                <th>Tipo</th>
                <th>Empresa</th>
                <th>Estado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              @for (vehiculo of currentVehiculos(); track vehiculo.id) {
                <tr class="table-row">
                  <td class="placa-cell">
                    <strong>{{ vehiculo.placa }}</strong>
                  </td>
                  <td>{{ vehiculo.marca }}</td>
                  <td>{{ vehiculo.modelo || 'No especificado' }}</td>
                  <td>{{ vehiculo.anioFabricacion }}</td>
                  <td>
                    <span class="badge badge-info">
                      {{ obtenerTipoVehiculoTexto(vehiculo.tipo) }}
                    </span>
                  </td>
                  <td>{{ vehiculo.empresaNombre || vehiculo.empresaId || 'No asignada' }}</td>
                  <td>
                    <span class="badge" [class]="obtenerClaseEstado(vehiculo.estado)">
                      {{ obtenerEstadoTexto(vehiculo.estado) }}
                    </span>
                  </td>
                  <td class="actions-cell">
                    <div class="action-buttons">
                      <button 
                        type="button" 
                        class="btn btn-sm btn-info" 
                        (click)="verVehiculo(vehiculo.id)"
                        title="Ver detalles"
                      >
                        <i class="fas fa-eye"></i>
                      </button>
                      <button 
                        type="button" 
                        class="btn btn-sm btn-primary" 
                        (click)="editarVehiculo(vehiculo.id)"
                        title="Editar vehículo"
                      >
                        <i class="fas fa-edit"></i>
                      </button>
                      <button 
                        type="button" 
                        class="btn btn-sm btn-danger" 
                        (click)="eliminarVehiculo(vehiculo.id)"
                        title="Eliminar vehículo"
                      >
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>

        <!-- Paginación -->
        @if (currentTotalPaginas() > 1) {
          <div class="pagination-section">
            <div class="pagination-info">
              <span>Página {{ currentPaginaActual() }} de {{ currentTotalPaginas() }}</span>
            </div>
            
            <div class="pagination-controls">
              <button 
                type="button" 
                class="btn btn-outline-primary" 
                [disabled]="currentPaginaActual() === 1"
                (click)="cambiarPagina(currentPaginaActual() - 1)"
              >
                <i class="fas fa-chevron-left"></i> Anterior
              </button>
              
              <div class="page-numbers">
                @for (pagina of getPageNumbers(); track pagina) {
                  <button 
                    type="button" 
                    class="btn"
                    [class.btn-primary]="pagina === currentPaginaActual()"
                    [class.btn-outline-primary]="pagina !== currentPaginaActual()"
                    (click)="cambiarPagina(pagina)"
                  >
                    {{ pagina }}
                  </button>
                }
              </div>
              
              <button 
                type="button" 
                class="btn btn-outline-primary" 
                [disabled]="currentPaginaActual() === currentTotalPaginas()"
                (click)="cambiarPagina(currentPaginaActual() + 1)"
              >
                Siguiente <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        }
      }

      <!-- Estado vacío -->
      @if (currentVehiculos().length === 0 && !isLoading()) {
        <div class="empty-state">
          <div class="empty-content">
            <i class="fas fa-bus"></i>
            <h3>No hay vehículos</h3>
            <p>No se encontraron vehículos con los filtros aplicados.</p>
            <button type="button" class="btn btn-primary" (click)="limpiarFiltros()">
              Limpiar filtros
            </button>
            <button type="button" class="btn btn-outline-primary" (click)="nuevoVehiculo()">
              Crear primer vehículo
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>
