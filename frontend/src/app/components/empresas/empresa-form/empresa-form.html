<div class="empresa-form-container">
  <!-- Header -->
  <div class="form-header">
    <div class="header-content">
      <h1 class="form-title">
        <i class="fas fa-building"></i>
        {{ currentIsEditMode() ? 'Editar Empresa' : 'Nueva Empresa' }}
      </h1>
      <p class="form-subtitle">
        {{ currentIsEditMode() ? 'Modificar información de la empresa' : 'Registrar nueva empresa de transporte' }}
      </p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="onCancel()">
        <i class="fas fa-times"></i>
        Cancelar
      </button>
    </div>
  </div>

  <!-- Loading -->
  @if (currentIsLoading()) {
    <div class="loading-container">
      <i class="fas fa-spinner fa-spin"></i>
      <span>Cargando información de la empresa...</span>
    </div>
  }

  <!-- Formulario -->
  @if (!currentIsLoading()) {
    <form [formGroup]="currentForm()" (ngSubmit)="onSubmit()" class="empresa-form">
      
      <!-- Información Básica -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-info-circle"></i>
          Información Básica
        </h2>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="ruc">RUC *</label>
            <div class="input-group">
              <input 
                type="text" 
                id="ruc" 
                formControlName="ruc"
                placeholder="Ingrese el RUC (11 dígitos)"
                maxlength="11"
                [class.error]="rucControl?.invalid && rucControl?.touched"
              >
              <button 
                type="button" 
                class="btn btn-outline" 
                (click)="verificarRUC()"
                [disabled]="!rucControl?.value || rucControl?.value?.length !== 11"
              >
                <i class="fas fa-search"></i>
                Verificar
              </button>
            </div>
            @if (rucControl?.invalid && rucControl?.touched) {
              <div class="error-message">
                @if (rucControl?.errors?.['required']) {
                  El RUC es obligatorio
                }
                @if (rucControl?.errors?.['pattern']) {
                  El RUC debe tener 11 dígitos
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label for="razonSocial">Razón Social *</label>
            <input 
              type="text" 
              id="razonSocial" 
              formControlName="razonSocial"
              placeholder="Ingrese la razón social"
              [class.error]="razonSocialControl?.invalid && razonSocialControl?.touched"
            >
            @if (razonSocialControl?.invalid && razonSocialControl?.touched) {
              <div class="error-message">
                @if (razonSocialControl?.errors?.['required']) {
                  La razón social es obligatoria
                }
                @if (razonSocialControl?.errors?.['minlength']) {
                  La razón social debe tener al menos 3 caracteres
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label for="razonSocialInterno">Razón Social Interno</label>
            <input 
              type="text" 
              id="razonSocialInterno" 
              formControlName="razonSocialInterno"
              placeholder="Ingrese la razón social interno (opcional)"
            >
          </div>

          <div class="form-group">
            <label for="nombreCorto">Nombre Corto</label>
            <input 
              type="text" 
              id="nombreCorto" 
              formControlName="nombreCorto"
              placeholder="Ingrese el nombre corto (opcional)"
            >
          </div>

          <div class="form-group">
            <label for="nombreComercial">Nombre Comercial</label>
            <input 
              type="text" 
              id="nombreComercial" 
              formControlName="nombreComercial"
              placeholder="Ingrese el nombre comercial (opcional)"
            >
          </div>

          <div class="form-group">
            <label for="tipoEmpresa">Tipo de Empresa *</label>
            <select id="tipoEmpresa" formControlName="tipoEmpresa">
              <option value="TRANSPORTE">Transporte</option>
              <option value="LOGISTICA">Logística</option>
              <option value="CARGA">Carga</option>
              <option value="PASAJEROS">Pasajeros</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Representante Legal -->
      <div class="form-section" formGroupName="representanteLegal">
        <h2 class="section-title">
          <i class="fas fa-user-tie"></i>
          Representante Legal
        </h2>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="nombres">Nombres *</label>
            <input 
              type="text" 
              id="nombres" 
              formControlName="nombres"
              placeholder="Ingrese los nombres"
            >
          </div>

          <div class="form-group">
            <label for="apellidos">Apellidos *</label>
            <input 
              type="text" 
              id="apellidos" 
              formControlName="apellidos"
              placeholder="Ingrese los apellidos"
            >
          </div>

          <div class="form-group">
            <label for="dni">DNI *</label>
            <input 
              type="text" 
              id="dni" 
              formControlName="dni"
              placeholder="Ingrese el DNI (8 dígitos)"
              maxlength="8"
            >
          </div>

          <div class="form-group">
            <label for="cargo">Cargo *</label>
            <input 
              type="text" 
              id="cargo" 
              formControlName="cargo"
              placeholder="Ingrese el cargo"
            >
          </div>

          <div class="form-group">
            <label for="telefonoRep">Teléfono *</label>
            <input 
              type="tel" 
              id="telefonoRep" 
              formControlName="telefono"
              placeholder="Ingrese el teléfono"
            >
          </div>

          <div class="form-group">
            <label for="emailRep">Email *</label>
            <input 
              type="email" 
              id="emailRep" 
              formControlName="email"
              placeholder="Ingrese el email"
            >
          </div>
        </div>
      </div>

      <!-- Representante Legal Secundario (Opcional) -->
      <div class="form-section" formGroupName="representanteLegalSecundario">
        <h2 class="section-title">
          <i class="fas fa-user-plus"></i>
          Representante Legal Secundario (Opcional)
        </h2>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="nombresSec">Nombres</label>
            <input 
              type="text" 
              id="nombresSec" 
              formControlName="nombres"
              placeholder="Ingrese los nombres"
            >
          </div>

          <div class="form-group">
            <label for="apellidosSec">Apellidos</label>
            <input 
              type="text" 
              id="apellidosSec" 
              formControlName="apellidos"
              placeholder="Ingrese los apellidos"
            >
          </div>

          <div class="form-group">
            <label for="dniSec">DNI</label>
            <input 
              type="text" 
              id="dniSec" 
              formControlName="dni"
              placeholder="Ingrese el DNI (8 dígitos)"
              maxlength="8"
            >
          </div>

          <div class="form-group">
            <label for="cargoSec">Cargo</label>
            <input 
              type="text" 
              id="cargoSec" 
              formControlName="cargo"
              placeholder="Ingrese el cargo"
            >
          </div>

          <div class="form-group">
            <label for="telefonoSec">Teléfono</label>
            <input 
              type="tel" 
              id="telefonoSec" 
              formControlName="telefono"
              placeholder="Ingrese el teléfono"
            >
          </div>

          <div class="form-group">
            <label for="emailSec">Email</label>
            <input 
              type="email" 
              id="emailSec" 
              formControlName="email"
              placeholder="Ingrese el email"
            >
          </div>
        </div>
      </div>

      <!-- Dirección -->
      <div class="form-section" formGroupName="direccion">
        <h2 class="section-title">
          <i class="fas fa-map-marker-alt"></i>
          Dirección
        </h2>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="departamento">Departamento *</label>
            <input 
              type="text" 
              id="departamento" 
              formControlName="departamento"
              placeholder="Departamento"
            >
          </div>

          <div class="form-group">
            <label for="provincia">Provincia *</label>
            <input 
              type="text" 
              id="provincia" 
              formControlName="provincia"
              placeholder="Provincia"
            >
          </div>

          <div class="form-group">
            <label for="distrito">Distrito *</label>
            <input 
              type="text" 
              id="distrito" 
              formControlName="distrito"
              placeholder="Distrito"
            >
          </div>

          <div class="form-group full-width">
            <label for="direccion">Dirección *</label>
            <input 
              type="text" 
              id="direccion" 
              formControlName="direccion"
              placeholder="Ingrese la dirección completa"
            >
          </div>

          <div class="form-group full-width">
            <label for="referencia">Referencia</label>
            <input 
              type="text" 
              id="referencia" 
              formControlName="referencia"
              placeholder="Punto de referencia (opcional)"
            >
          </div>
        </div>
      </div>

      <!-- Información de Contacto -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-phone"></i>
          Información de Contacto
        </h2>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="telefono">Teléfono *</label>
            <input 
              type="tel" 
              id="telefono" 
              formControlName="telefono"
              placeholder="Ingrese el teléfono"
            >
          </div>

          <div class="form-group">
            <label for="email">Email *</label>
            <input 
              type="email" 
              id="email" 
              formControlName="email"
              placeholder="Ingrese el email"
            >
          </div>

          <div class="form-group">
            <label for="sitioWeb">Sitio Web</label>
            <input 
              type="url" 
              id="sitioWeb" 
              formControlName="sitioWeb"
              placeholder="https://www.ejemplo.com"
            >
          </div>

          <div class="form-group">
            <label for="fechaConstitucion">Fecha de Constitución *</label>
            <input 
              type="date" 
              id="fechaConstitucion" 
              formControlName="fechaConstitucion"
            >
          </div>
        </div>
      </div>

      <!-- Expediente -->
      <div class="form-section" formGroupName="expediente">
        <h2 class="section-title">
          <i class="fas fa-folder-open"></i>
          Información del Expediente
        </h2>
        
        <div class="form-grid">
          <div class="form-group">
            <label for="numeroExpediente">Número de Expediente *</label>
            <input 
              type="text" 
              id="numeroExpediente" 
              formControlName="numero"
              placeholder="E-1234-2025"
              [class.error]="expedienteGroup.get('numero')?.invalid && expedienteGroup.get('numero')?.touched"
            >
            @if (expedienteGroup.get('numero')?.invalid && expedienteGroup.get('numero')?.touched) {
              <div class="error-message">
                @if (expedienteGroup.get('numero')?.errors?.['required']) {
                  El número de expediente es obligatorio
                }
                @if (expedienteGroup.get('numero')?.errors?.['pattern']) {
                  El formato debe ser E-1234-2025
                }
              </div>
            }
          </div>

          <div class="form-group">
            <label for="fechaExpediente">Fecha del Expediente *</label>
            <input 
              type="date" 
              id="fechaExpediente" 
              formControlName="fecha"
            >
          </div>

          <div class="form-group">
            <label for="estadoExpediente">Estado del Expediente *</label>
            <select id="estadoExpediente" formControlName="estado">
              <option value="ABIERTO">Abierto</option>
              <option value="EN_TRAMITE">En Trámite</option>
              <option value="APROBADO">Aprobado</option>
              <option value="RECHAZADO">Rechazado</option>
              <option value="CERRADO">Cerrado</option>
            </select>
          </div>

          <div class="form-group full-width">
            <label for="observacionesExpediente">Observaciones del Expediente</label>
            <textarea 
              id="observacionesExpediente" 
              formControlName="observaciones"
              placeholder="Observaciones adicionales sobre el expediente..."
              rows="3"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- Estado -->
      <div class="form-section">
        <h2 class="section-title">
          <i class="fas fa-toggle-on"></i>
          Estado
        </h2>
        
        <div class="form-group">
          <label for="estado">Estado de la Empresa *</label>
          <select id="estado" formControlName="estado">
            <option value="PENDIENTE">Pendiente</option>
            <option value="ACTIVO">Activo</option>
            <option value="SUSPENDIDO">Suspendido</option>
            <option value="CANCELADO">Cancelado</option>
          </select>
        </div>
      </div>

      <!-- Documentos -->
      <div class="form-section" formGroupName="documentos">
        <h2 class="section-title">
          <i class="fas fa-file-alt"></i>
          Documentos Requeridos
        </h2>
        
        <div class="documentos-grid">
          <div class="documento-item">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="ruc">
              <span class="checkmark"></span>
              RUC vigente
            </label>
          </div>

          <div class="documento-item">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="partidaRegistral">
              <span class="checkmark"></span>
              Partida Registral
            </label>
          </div>

          <div class="documento-item">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="poderRepresentante">
              <span class="checkmark"></span>
              Poder del Representante
            </label>
          </div>

          <div class="documento-item">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="declaracionJurada">
              <span class="checkmark"></span>
              Declaración Jurada
            </label>
          </div>
        </div>

        <div class="form-group">
          <label for="otrosDocumentos">Otros Documentos</label>
          <textarea 
            id="otrosDocumentos" 
            formControlName="otros"
            placeholder="Especifique otros documentos requeridos..."
            rows="3"
          ></textarea>
        </div>
      </div>

      <!-- Acciones del Formulario -->
      <div class="form-actions">
        <!-- Resumen de errores -->
        @if (currentForm().invalid && currentForm().touched) {
          <div class="form-errors-summary">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Por favor, corrija los errores en el formulario antes de continuar</span>
          </div>
        }
        
        <div class="form-buttons">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="onCancel()"
            [disabled]="currentIsSaving()"
          >
            <i class="fas fa-times"></i>
            Cancelar
          </button>
          
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="currentForm().invalid || currentIsSaving()"
            (click)="markFormGroupTouched()"
          >
            @if (currentIsSaving()) {
              <i class="fas fa-spinner fa-spin"></i>
              Guardando...
            } @else {
              <i class="fas fa-save"></i>
              {{ currentIsEditMode() ? 'Actualizar' : 'Crear' }} Empresa
            }
          </button>
        </div>
      </div>
    </form>
  }
</div> 